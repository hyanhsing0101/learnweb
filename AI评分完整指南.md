# 🤖 AI评分功能完整指南

## 📋 功能说明

AI评分功能使用火山方舟（字节跳动豆包大模型）为简答题提供智能评分和反馈。支持用户自定义API Key和模型配置，所有配置保存在浏览器本地，不会上传到服务器。

---

## 🚀 快速开始

### 第一步：获取API配置信息

#### 1. 获取 API Key

1. 访问 [火山方舟控制台](https://console.volcengine.com/ark)
2. 登录账号（如无账号需先注册）
3. 进入 **「API密钥管理」**
4. 点击 **「创建密钥」**
5. 复制生成的 API Key（格式示例：`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`）

#### 2. 获取 Endpoint（API端点）

**火山方舟默认端点：**
```
https://ark.cn-beijing.volces.com/api/v3/chat/completions
```

**说明：**
- 北京区域：`https://ark.cn-beijing.volces.com/api/v3/chat/completions`
- 其他区域可在控制台的「接入点详情」中查看

#### 3. 获取 Model（接入点ID）

1. 进入火山方舟控制台的 **「模型推理」→「在线推理」**
2. 点击 **「创建接入点」**
3. 选择模型（推荐：`豆包-pro-32k` 或 `豆包-lite-32k`）
4. 创建成功后，复制 **「接入点ID」**

**格式示例：**
```
ep-m-20241201000000-abcde
ep-20241114211055-xxxxx
```

---

## ⚙️ 配置步骤

### 方法一：通过AI配置弹窗（推荐）

这是最简单的方式，适合所有用户：

1. **打开配置弹窗**
   - 在简答题页面，点击页面顶部的 **「🤖 AI配置」** 按钮
   - 或在弹窗标题栏点击 **「📖 查看指南」** 了解详情

2. **填写配置信息**
   - ✅ 勾选 **「启用AI评分功能」**
   - 🔑 填入 **API Key**（点击👁️可显示/隐藏）
   - 🌐 填入 **API端点**（默认已填充）
   - 🤖 填入 **模型ID**（接入点ID）
   - ⚙️ 如需调整，可展开 **「高级参数」**：
     - Temperature（温度参数）：默认0.3，控制输出的随机性
     - Max Tokens（最大返回长度）：默认200，影响成本和响应时间

3. **保存配置**
   - 点击 **「保存配置」** 按钮
   - 配置会自动保存到浏览器本地（localStorage）
   - 下次使用时配置会自动加载

4. **测试使用**
   - 返回简答题页面
   - 填写一道题的答案
   - 点击 **「🤖 AI评分」** 按钮
   - 等待1-3秒查看评分结果

### 方法二：修改配置文件（开发者）

如果你想直接修改代码配置：

1. 复制配置示例文件：
   ```bash
   cp assets/js/ai-config.example.js assets/js/ai-config.js
   ```

2. 打开 `assets/js/ai-config.js`，修改以下内容：
   ```javascript
   const DEFAULT_AI_CONFIG = {
     enabled: true,  // 启用AI功能
     apiKey: '你的API Key',
     endpoint: 'https://ark.cn-beijing.volces.com/api/v3/chat/completions',
     model: '你的接入点ID',
     temperature: 0.3,
     maxTokens: 200,
   };
   ```

3. 刷新页面即可使用

---

## 📝 配置示例

在「AI配置」弹窗中填入的示例：

| 配置项 | 示例值 |
|--------|--------|
| **启用AI功能** | ✅ 已勾选 |
| **API Key** | `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` |
| **Endpoint** | `https://ark.cn-beijing.volces.com/api/v3/chat/completions` |
| **Model** | `ep-m-20241201000000-abcde` |
| **Temperature** | `0.3` |
| **Max Tokens** | `200` |

---

## 🎯 使用说明

### 如何使用AI评分功能

1. **准备工作**
   - 确保已配置API Key和模型信息
   - 已启用AI评分功能

2. **使用步骤**
   - 进入 **「📝 简答题」** 页面
   - 在任意题目下填写你的答案
   - 点击题目下方的 **「🤖 AI评分」** 按钮
   - 等待1-3秒，AI会自动分析你的答案

3. **查看评分结果**

   AI评分结果包含：
   - ✅ **分数**：0-100分，直观显示答题质量
   - 💬 **总体评价**：答案的整体质量分析
   - ✅ **答题优点**：答对的要点和亮点
   - 💡 **改进建议**：可以改进的地方

4. **评分等级**
   - **90-100分**：优秀（绿色显示）
   - **80-89分**：良好（蓝色显示）
   - **70-79分**：中等（橙色显示）
   - **60-69分**：及格（橙红色显示）
   - **60分以下**：不及格（红色显示）

### 如何管理AI配置

1. **打开配置弹窗**
   - 点击简答题页面顶部的 **「🤖 AI配置」** 按钮

2. **修改配置**
   - 更新API Key、端点或模型ID
   - 调整高级参数（如需要）
   - 点击 **「保存配置」**

3. **恢复默认配置**
   - 点击 **「恢复默认」** 按钮
   - 确认后配置将恢复为默认值

4. **禁用功能**
   - 取消勾选 **「启用AI评分功能」**
   - 保存后AI评分功能将被禁用

---

## 📊 API 费用

### 火山方舟定价（参考）

- **豆包-lite-32k**：~¥0.0003/千tokens（约0.003元/题）
- **豆包-pro-32k**：~¥0.001/千tokens（约0.01元/题）

### 免费额度

- 新用户通常有一定免费额度
- 每月有免费调用次数
- 具体以火山方舟官网为准

### 成本优化建议

- 使用 `maxTokens: 200` 可以降低每次调用成本
- 使用 `豆包-lite-32k` 模型价格更低
- 评分结果已优化，减少不必要的token消耗

---

## ⚠️ 注意事项

### 1. API Key 安全

- ⚠️ **不要将API Key分享给他人**
- ⚠️ **不要将API Key提交到GitHub公开仓库**
- ✅ 配置保存在浏览器本地，不会上传到服务器
- ✅ 使用`.gitignore`排除`ai-config.js`文件

### 2. 保护API Key

在`.gitignore`中添加：
```
# AI配置（包含敏感信息）
assets/js/ai-config.js
```

### 3. 网络要求

- ✅ 火山方舟国内访问速度快
- ✅ 无需翻墙
- ⚠️ 需要稳定的网络连接

### 4. 区域选择

- 确保 Endpoint 区域与你的接入点区域一致
- 不同区域可能有不同的性能和价格

---

## 🔧 常见问题

### Q1: 点击"AI评分"提示"功能未启用"

**A:** 
- 打开AI配置弹窗
- 勾选 **「启用AI评分功能」**
- 确保已填写API Key、Endpoint和Model
- 点击保存配置

### Q2: 提示"API Key未配置"

**A:** 
- 检查AI配置弹窗中是否已填写API Key
- 确保API Key格式正确
- 尝试重新保存配置

### Q3: 提示"401 Unauthorized"

**A:** 
- API Key错误或已过期
- 重新生成API Key并更新配置
- 检查API Key是否完整复制

### Q4: 提示"模型不存在"

**A:** 
- 检查Model字段是否填写正确的接入点ID
- 确认接入点ID格式：`ep-m-20241201000000-abcde`
- 确认接入点已创建并启用

### Q5: 响应很慢

**A:** 
- 检查网络连接
- 可以降低`maxTokens`参数（如改为150）
- 切换到lite版本模型（价格更低，速度可能更快）

### Q6: 评分不准确

**A:** 
- 调整`temperature`参数（建议0.2-0.4，越小越严格）
- 确保参考答案质量高
- 多次尝试可能得到不同评分（AI有随机性）

### Q7: 配置丢失了

**A:** 
- 配置保存在浏览器本地，清除浏览器数据会丢失
- 建议备份配置信息
- 可以导出/导入配置功能（如需要）

### Q8: 如何切换不同的API服务商

**A:** 
- 目前支持火山方舟，如需其他服务商需要修改代码
- 可以参考`ai-config.js`中的实现
- 确保API接口格式兼容

---

## 🛠️ 调试技巧

### 查看API调用状态

1. 打开浏览器开发者工具（按`F12`）
2. 切换到 **「Console」** 标签
3. 点击AI评分按钮
4. 查看控制台输出：
   - ✅ API调用状态
   - ❌ 错误信息
   - 📊 响应内容

### 查看网络请求

1. 打开开发者工具（`F12`）
2. 切换到 **「Network」** 标签
3. 点击AI评分按钮
4. 查看发送到API的请求：
   - 请求URL
   - 请求头
   - 请求体
   - 响应内容

### 检查配置是否正确加载

1. 打开开发者工具（`F12`）
2. 切换到 **「Console」** 标签
3. 输入：`localStorage.getItem('aiConfig')`
4. 查看配置是否正确保存

---

## 💡 进阶配置

### 自定义评分标准

可以修改`ai-config.js`中的`SCORING_PROMPT`来自定义评分标准：

```javascript
const SCORING_PROMPT = `你是一位严谨的Web开发课程老师，正在批改简答题。

【评分标准】
1. 要点完整性（50分）：必须包含核心概念
2. 表述准确性（30分）：专业术语使用正确
3. 逻辑清晰度（20分）：条理清楚、有层次
...
`;
```

### 调整评分严格程度

- **更严格**：降低`temperature`（如0.2）
- **更宽松**：提高`temperature`（如0.4）
- **更详细反馈**：提高`maxTokens`（如300）

### 多模型切换

可以创建不同的配置预设，用于不同场景：

```javascript
const AI_MODELS = {
  strict: { model: 'ep-xxx-pro', temperature: 0.2 },  // 严格评分
  normal: { model: 'ep-xxx-pro', temperature: 0.3 },  // 正常评分
  lenient: { model: 'ep-xxx-lite', temperature: 0.5 } // 宽松评分
};
```

---

## 📚 参考资料

- **火山方舟控制台**：https://console.volcengine.com/ark
- **火山方舟官方文档**：https://www.volcengine.com/docs/82379
- **API接口文档**：https://www.volcengine.com/docs/82379/1099320
- **模型介绍**：https://www.volcengine.com/docs/82379/1099455

---

## 🎉 开始使用

配置完成后，刷新页面即可使用AI评分功能！

1. ✅ 获取API Key和接入点ID
2. ✅ 在AI配置弹窗中填写信息
3. ✅ 启用AI评分功能
4. ✅ 开始使用AI评分！

**祝你学习愉快！** 🚀

